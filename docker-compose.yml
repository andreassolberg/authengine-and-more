version: '2'
services:
  cassandra:
    image: cassandra:2.2
    ports:
      - "9042"
  dataportenschemas:
    image: uninett-docker-uninett.bintray.io/feideconnect/dataportenschemas
    links:
      - cassandra:cassandra
    environment:
      - CASSANDRA_NODE=cassandra
      - CASSANDRA_KEYSPACE=dataporten
      - TESTDATA=true
    command: up
  testenv:
    build: .
    links:
      - cassandra:cassandra
    volumes:
      - ./build:/authengine/build
      - ./lib:/authengine/lib
      - ./tests:/authengine/tests
      - ./test-config/jwt-cert.pem:/authengine/etc/jwt-cert.pem
      - ./test-config/jwt-key.pem:/authengine/etc/jwt-key.pem
      - ./test-config/testusers.json:/authengine/etc/testusers.json
    environment:
      - FC_CASSANDRA_CONTACTPOINTS=cassandra:9042
      - FC_CASSANDRA_KEYSPACE=dataporten
      - FC_CASSANDRA_USESSL=false
      - AE_TESTUSERSFILE=testusers.json
